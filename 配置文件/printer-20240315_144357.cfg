# This file works for GuguBOT with MKS Monster8 V2.0 Only
# 本配置适用于使用MKS Monster8 V2.0版本主板的GuguBOT

[include mainsail.cfg]
[include ebb-canbus-v1.2.cfg]
[include macros.cfg]
[mcu]
## Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
#serial: /dev/serial/by-id/usb-Klipper_stm32f407xx_460047000D50315141323320-if00
canbus_uuid:313c75eb5119

#--------------------------------------------------------------------
##--------------------------------------------------------------------
[printer]
kinematics: corexy
max_velocity: 500
max_accel: 20000
max_z_velocity: 15
max_z_accel: 300
square_corner_velocity: 5.0

#############################################
# AB电机设置
#############################################

#--------------------------------------------------------------------
# 供CoreXY AB电机方向测试时使用，日常使用请勿开启
##-------------------------------------------------------------------
#[force_move]
#enable_force_move: True
#[respond]
##-------------------------------------------------------------------

## B电机(右后) 接主板Y驱动(Drive1:Y) 
[stepper_x]
step_pin:PE5
dir_pin:PE4
enable_pin:!PC15
microsteps:128
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin:PA14 
position_min: 0
position_endstop:280
position_max:280
homing_speed:60
second_homing_speed:10
homing_retract_speed:10
homing_retract_dist:5
homing_positive_dir:true

[tmc2209 stepper_x]
uart_pin: PE3
interpolate: False
run_current: 1.1
#hold_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

## A电机(左后) 接主板X驱动(Drive0:X) 
[stepper_y]
step_pin:PC14
dir_pin:PC13
enable_pin:!PC15
microsteps: 128
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin:PA15
position_min: 0  
position_endstop: 300
position_max: 300
homing_speed:60
second_homing_speed:10
homing_retract_speed:10
homing_retract_dist:5
homing_positive_dir:true

[tmc2209 stepper_y]
uart_pin: PE6
interpolate: False
run_current: 1.1
#hold_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

#############################################
# Z电机设置
#############################################

## Z0电机(左前) 接主板Z驱动(Drive2:Z1) 
[stepper_z]
step_pin:PE1
dir_pin:!PE0
enable_pin: !PE2
microsteps: 128
rotation_distance: 2          #与丝杠导程数一致
full_steps_per_rotation: 200
endstop_pin:PB13
##  Z-position of nozzle (in mm) to z-endstop trigger point relative to print surface (Z0)
##  (+) value = endstop above Z0, (-) value = endstop below
##	Increasing position_endstop brings nozzle closer to the bed
##  After you run Z_ENDSTOP_CALIBRATE, position_endstop will be stored at the very end of your config
#position_endstop:0
position_max: 300
position_min: -10
homing_speed: 6
second_homing_speed: 3.0
homing_retract_dist: 3.0

[tmc2209 stepper_z]
uart_pin: PB7
interpolate: False
run_current: 0.8
#hold_current: 0.5
stealthchop_threshold: 0

## Z1电机(后) 接主板E1驱动(Drive4:E1)
[stepper_z1]
step_pin:PD6
dir_pin:!PD5
enable_pin:!PD7
microsteps:128
rotation_distance: 2         #与丝杠导程数一致
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PD4
interpolate: False
run_current: 0.8
#hold_current: 0.5
stealthchop_threshold: 0

## Z2电机(右前) 接主板E2驱动(Drive5:E2)
[stepper_z2]
step_pin:PD2
dir_pin:!PD1
enable_pin:!PD3
microsteps: 128
rotation_distance: 2         #与丝杠导程数一致
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PD0
interpolate: False
run_current: 0.8
#hold_current: 0.5
stealthchop_threshold: 0


########################################
# 热床
########################################
[heater_bed]
heater_pin: PB10
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PC0
max_power: 1.0
#control = pid          #校准在控制台输入PID_CALIBRATE HEATER=bed TARGET=50
#pid_kp = 72.923
#pid_ki = 0.634
#pid_kd = 2097.460
min_temp: 0
max_temp: 95




[probe]
pin: !EBBCan: PB6
#   探针检测引脚。如果引脚在与Z轴步进电机不同的微控制器上，
#   则启用“多MCU归位”。
#   必须提供此参数。
#deactivate_on_each_sample: True
#   这决定了在执行多次探测尝试时，Klipper是否应在每次尝试之间
#   执行取消激活(deactivate)G代码。
#   默认为True。
x_offset: 20.7
#   探针和喷嘴在x轴上的距离（以mm为单位）。
#   默认为0。
y_offset: 6.5
#   探针和喷嘴在y轴上的距离（以mm为单位）。
#   默认为0。
#z_offset:5
#   当探针触发时，床和喷嘴之间的距离（以mm为单位）。
#   必须提供此参数。
#speed: 5.0
#   探测时Z轴的速度（以mm/s为单位）。
#   默认为5mm/s。
samples: 4
#   探测每个点的次数。探测的z值将被平均。
#   默认是探测1次。
sample_retract_dist: 4
#   在每个样本之间提升打印头的距离（以mm为单位）（如果采样超
#   过一次）。
#   默认为2mm。
#lift_speed:
#   在样本之间提升探针时Z轴的速度（以mm/s为单位）。
#   默认使用与'speed'参数相同的值。
#samples_result: average
#   采样超过一次时的计算方法 - median(中位数) 或average（平均值）。
#   默认为 average。
#samples_tolerance: 0.100
#   样本可能与其他样本的最大Z距离（以mm为单位）差异。
#   如果超出此公差，则报告错误或重新开始尝试（参见
#   samples_tolerance_retries）。
#   默认为0.100mm。
#samples_tolerance_retries: 0
#   如果发现超过samples_tolerance的样本，重试的次数。
#   在重试时，丢弃所有当前的样本并重新开始探针尝试。
#   如果在给定的重试次数内未获得有效的样本集，则报告错误。
#   默认值为0，这导致在第一个超过samples_tolerance的样本上报告错误。
#activate_gcode:
#   在每次探针尝试之前执行的G-Code命令列表。有关G-Code格式，请参见
#   docs/Command_Templates.md。如果需要以某种方式激活探针，
#   这可能会很有用。不要在此处发送任何移动打印头的命令（例如，G1）。
#   默认情况下，激活时不运行任何特殊的G-Code命令。
#deactivate_gcode:
#   在每次探针尝试完成后执行的G-Code命令列表。有关G-Code格式，
#   请参见docs/Command_Templates.md。不要在此处发送任何移动
#   工具头的命令。
#   默认情况下，取消激活时不运行任何特殊的G-Code命令。




#[bed_mesh]
#speed: 120
#horizontal_move_z: 5
#mesh_min: 35, 6
#mesh_max: 240, 198
#probe_count: 5, 3




[z_tilt]
z_positions:            # Z轴丝杆所在坐标
  -52,-23
  163,375
  346,-23
#   A list of X, Y coordinates (one per line; subsequent lines
#   indented) describing the location of each bed "pivot point". The
#   "pivot point" is the point where the bed attaches to the given Z
#   stepper. It is described using nozzle coordinates (the X, Y position
#   of the nozzle if it could move directly above the point). The
#   first entry corresponds to stepper_z, the second to stepper_z1,
#   the third to stepper_z2, etc. This parameter must be provided.
points:                 # 探测点喷嘴的坐标，注意不是探针坐标
  10,5
  150,260
  265,5
#   A list of X, Y coordinates (one per line; subsequent lines
#   indented) that should be probed during a Z_TILT_ADJUST command.
#   Specify coordinates of the nozzle and be sure the probe is above
#   the bed at the given nozzle coordinates. This parameter must be
#   provided.
speed: 100
#   The speed (in mm/s) of non-probing moves during the calibration.
#   The default is 50.
horizontal_move_z: 16  #z轴高度
#   The height (in mm) that the head should be commanded to move to
#   just prior to starting a probe operation. The default is 5.
retries: 5    #尝试次数，不同点之间的高度差大于下方的retry_tolerance值时候会进行重试。
#   Number of times to retry if the probed points aren't within
#   tolerance.
retry_tolerance: 0.05   #允许不同点的高度差
#   If retries are enabled then retry if largest and smallest probed
#   points differ more than retry_tolerance. Note the smallest unit of
#   change here would be a single step. However if you are probing
#   more points than steppers then you will likely have a fixed
#   minimum value for the range of probed points which you can learn
#   by observing command output.




[bed_mesh]
speed: 100
horizontal_move_z: 10
mesh_min: 30, 10
mesh_max: 275, 275
probe_count: 6, 6
algorithm: bicubic
mesh_pps: 2,2
ZERO_REFERENCE_POSITION:150,150


[virtual_sdcard]
path: /home/biqu/printer_data/gcodes
#path: /home/klipper/printer_data/gcodes


[pause_resume]       #暂停/恢复功能，支持位置储存和恢复。
#recover_velocity: 50.
# 当捕捉/恢复功能被启用时，返回到捕获的位置的速度(单位：毫米/秒)。
# 默认为50.0 mm/s。


[exclude_object]     #启用对在打印过程中排除或取消单个对象的支持。



[display_status]

[safe_z_home]
home_xy_position:193,300
#   一个X，Y坐标（例如100，100），在这个坐标上应该进行Z归位。
#   必须提供此参数
#peed: 50.0
#   工具头移动到安全Z原点的速度。
#   默认为50毫米/秒
z_hop:10
#   在归位前抬升Z轴的距离（mm）。这将用于任何归位命令，即使
#   它没有将Z轴归位。
#   如果Z轴已经归位，并且当前的Z轴位置小于z_hop，那么这条命令
#   将把打印头提升到z_hop的高度。如果
#   Z轴尚未归位，则打印头将被提升z_hop的高度。
#   默认不执行Z抬升。
z_hop_speed: 10
#   在归位之前，Z轴抬升的速度（单位：mm/s）。
#   默认为15mm/s。
move_to_previous: False
#   当设置为 "True "时，X轴和Y轴在Z轴归位后会重置到之前的位置。
#   默认为false。


[gcode_arcs]        #支持G代码弧线(G2/G3)命令
resolution: 0.2
#   一条弧线将被分割成若干段。每段的长度将
#   等于上面设置的分辨率（mm）。更低的值会产生一个
#   更细腻的弧线，但也会需要机器进行更多运算。小于
#   配置值的曲线会被视为直线。
#   默认为1毫米。

[sdcard_loop]     #一些具有阶段清空功能的打印机，如打印件移除器或带式打印机，可以找到并使用sdcard文件中循环部分




#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 1.005
#*#
#*# [extruder]
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 71.189
#*# pid_ki = 1.230
#*# pid_kd = 1030.458
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 87.4
#*# shaper_type_y = 2hump_ei
#*# shaper_freq_y = 66.8
#*#
#*# [probe]
#*# z_offset = 0.550
#*#
#*# [bed_mesh petg_80]
#*# version = 1
#*# points =
#*# 	-0.115090, 0.079168, 0.147156, 0.079617, -0.088684
#*# 	-0.132043, 0.034285, 0.096316, 0.028426, -0.110461
#*# 	-0.240071, -0.073020, 0.012078, -0.031731, -0.158430
#*# 	-0.381907, -0.174582, -0.085735, -0.095285, -0.223606
#*# 	-0.460578, -0.224387, -0.144270, -0.118567, -0.228235
#*# min_x = 30.0
#*# max_x = 275.0
#*# min_y = 10.0
#*# max_y = 275.0
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*#
#*# [bed_mesh pla_60]
#*# version = 1
#*# points =
#*# 	-0.021648, 0.124758, 0.176652, 0.120344, 0.006613
#*# 	-0.086355, 0.058059, 0.120617, 0.082590, 0.005070
#*# 	-0.202918, -0.061785, 0.013254, -0.009207, -0.086121
#*# 	-0.344988, -0.189578, -0.096727, -0.091180, -0.165809
#*# 	-0.385340, -0.223406, -0.159617, -0.127254, -0.185066
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 275.0
#*# min_y = 10.0
#*# max_y = 275.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.109191, 0.058543, 0.117625, 0.104910, 0.058055, -0.065109
#*# 	  -0.088117, 0.044696, 0.093504, 0.070926, 0.003602, -0.073097
#*# 	  -0.085187, 0.010321, 0.049578, 0.016453, -0.047668, -0.118390
#*# 	  -0.142121, -0.046945, -0.011554, -0.032765, -0.102179, -0.193879
#*# 	  -0.176554, -0.087765, -0.078508, -0.102883, -0.176535, -0.266105
#*# 	  -0.178136, -0.104152, -0.088156, -0.102570, -0.176633, -0.289074
#*# x_count = 6
#*# y_count = 6
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 275.0
#*# min_y = 10.0
#*# max_y = 275.0
